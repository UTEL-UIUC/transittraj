# transittraj

An R package for reconstructing and visualizing transit vehicle
trajectories.

This is an early development version of `transittraj`. Expect it to
change without warning.

## Introduction

Today’s transit vehicles generate a large amount of automatic vehicle
location (AVL) data. This data is vital in planning and performance
studies, but turning sparse and noisy GPS pings into meaningful
performance metrics is difficult. `transittraj` fills this gap,
integrating with existing open data standards, including GTFS and TIDES,
to provide tools for cleaning AVL data and fitting continuous,
monotonic, invertible, and differentiable trajectory curves. By doing
so, `transittraj` provides versatile and powerful tools to analyze
transit system performance and support decision-making.

![\`transittraj\` converts noisy GPS data (left) to a trajectory (right)
meeting the four requirements discussed
below](reference/figures/README-example2.png)

`transittraj` converts noisy GPS data (left) to a trajectory (right)
meeting the four requirements discussed below

Upgrading GTFS validator to ignore tables with zero observations

## Installation

You can install the development version of `transittraj` from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("UTEL-UIUC/transittraj")
```

## Statement of Need

The primary goal of `transittraj` is to reconstruct *trajectories* of
transit vehicles from AVL data. A trajectory is a function which
describes the one-dimensional position (i.e., the distance from a trip’s
beginning) of a transit vehicle over time. Vehicle trajectories are
incredibly powerful and versatile tools, and are widely used by traffic
engineers and operations researchers for planning and system performance
studies.

Despite this, transit professionals rarely have the opportunity to see
detailed trajectories of their vehicles, and instead typically only
receive finalized metrics – such as dwell time and segment-level travel
times – from analytics platforms. If a practitioner wanted to apply
trajectory fitting tools from parallel fields, they would likely
encounter challenges: transit data adheres to unique formatting
standards; very few open-source tools exist for handling transit vehicle
location data; and, most importantly, common GPS processing techniques
can oversmooth transit trajectories, as AVL pings occur with the same
frequency (15-30 seconds) as stop dwells, signal delays, and other
stop-and-go cyles.

`transittraj` fills this gap this gap by proposing a workflow with two
main steps. The first is data cleaning, where we focus on correcting
noise and errors in point observations. Second, we use cleaned position
and speed measurements to fit an interpolating curve representing the
vehicle’s trajectory. This curve has four important attributes:

- *Continuous*: There should be no gaps in the trajectory for each trip.

- *Monotonic*: The trajectory should be strictly increasing – transit
  vehicles typically don’t back up in service.

- *Invertible*: The trajectory should provide position as a function of
  time, or time as a function of position.

- *Differentiable*: At any point on the curve, we should be able to
  interpolate for the speed of the vehicle.

`transittraj` aims to make these workflows as smooth and accessible as
possible. We begin with data that adheres to industry standard data
formats, including [GTFS](https://gtfs.org/) and
[TIDES](https://tides-transit.org/main/). In our cleaning and trajectory
fitting, our functions are flexible but avoid techniques which require
complex tuning. Finally, we provide tools to visualize and apply fit
trajectory curves.

![Overview of \`transittraj\`
workflow](reference/figures/README-arch.png)

Overview of `transittraj` workflow

Check out the vignettes below to get started.

## Getting Started with `transittraj`

Check out the following vignettes to learn more about how to use
`transittraj`:

- [Understanding Data
  Inputs](https://utel-uiuc.github.io/transittraj/articles/input-data.html)

- [The AVL Cleaning
  Workflow](https://utel-uiuc.github.io/transittraj/articles/data-workflow.html)

- [Using
  Trajectories](https://utel-uiuc.github.io/transittraj/articles/intro-trajectories.html)

## Works in Progress

This package is still in early development. In prepartion for an
eventual submission to CRAN, we’re still working on the following:

- Examples in all function documentation

- Sample datasets to include with `transittraj`

- Formal automated testing

- Vignettes discussing methodology and inner-workings of `transittraj`

## Citation

`transittraj` is free and open source, but if you find the package
helpful, we’d appreciate a citation:

``` r
citation("transittraj")
#> To cite package 'transittraj' in publications use:
#> 
#>   O'Brien B, Lehe L (2026). _transittraj: Reconstruct and Visualize
#>   Transit Vehicle Trajectories_. R package version 0.0.0.9000, commit
#>   ce1262e5ffde138ec4e1f3708416cda4ab3810bc,
#>   <https://github.com/UTEL-UIUC/transittraj>.
#> 
#> A BibTeX entry for LaTeX users is
#> 
#>   @Manual{,
#>     title = {transittraj: Reconstruct and Visualize Transit Vehicle Trajectories},
#>     author = {Benjamin O'Brien and Lewis Lehe},
#>     year = {2026},
#>     note = {R package version 0.0.0.9000, commit ce1262e5ffde138ec4e1f3708416cda4ab3810bc},
#>     url = {https://github.com/UTEL-UIUC/transittraj},
#>   }
```

# Package index

## GTFS Helpers

Functions to manipulate tidygtfs objects.

- [`filter_by_route()`](https://obrien-ben.github.io/transittraj/reference/filter_by_route.md)
  : Filter GTFS to a desired route(s) and direction(s).
- [`get_shape_geometry()`](https://obrien-ben.github.io/transittraj/reference/get_shape_geometry.md)
  : Get the geometry of a route shape.
- [`project_onto_route()`](https://obrien-ben.github.io/transittraj/reference/project_onto_route.md)
  : Projects points to linear distances along a route shape.
- [`get_stop_distances()`](https://obrien-ben.github.io/transittraj/reference/get_stop_distances.md)
  : Get the distances of stops along routes.
- [`plot_interactive_gtfs()`](https://obrien-ben.github.io/transittraj/reference/plot_interactive_gtfs.md)
  : Generates a Leaflet viewer of GTFS routes and stops.

## AVL Cleaning

Functions to clean AVL data.

- [`get_linear_distances()`](https://obrien-ben.github.io/transittraj/reference/get_linear_distances.md)
  : Linearizes latitude-longitude GPS points to a provided route shape.
- [`clean_overlapping_subtrips()`](https://obrien-ben.github.io/transittraj/reference/clean_overlapping_subtrips.md)
  : Removes trips with multiple overlapping operators or vehicles
  assigned to the same trip number.
- [`clean_jumps()`](https://obrien-ben.github.io/transittraj/reference/clean_jumps.md)
  : Applies median filters to detect large jumps (i.e., outliers) in the
  trajectories.
- [`clean_incomplete_trips()`](https://obrien-ben.github.io/transittraj/reference/clean_incomplete_trips.md)
  : Filters out entire trips which do not meet distance or duration
  requirements.
- [`trim_trips()`](https://obrien-ben.github.io/transittraj/reference/trim_trips.md)
  : Removes observations occurring before a trip's minimum distance, or
  after a trip's maximum distance.
- [`make_monotonic()`](https://obrien-ben.github.io/transittraj/reference/make_monotonic.md)
  : Corrects distance observations, and optionally speeds, to be weakly
  or strictly monotonic.

## Trajectory Construction

Functions to build trajectory objections.

- [`get_trajectory_fun()`](https://obrien-ben.github.io/transittraj/reference/get_trajectory_fun.md)
  : Fits continuous trajectory interpolating curves from transit AVL
  data.
- [`get_gtfs_trajectory_fun()`](https://obrien-ben.github.io/transittraj/reference/get_gtfs_trajectory_fun.md)
  : Fits continuous trajectory interpolating curves from GTFS schedule
  data.

## Trajectory Plotting

Functions to plot trajectories.

- [`plot(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/plot.avltrajectory_group.md)
  [`plot(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/plot.avltrajectory_group.md)
  : \#' Quickly plots an AVL trajectory.
- [`plot_animated_line()`](https://obrien-ben.github.io/transittraj/reference/plot_animated_line.md)
  [`plot_animated_map()`](https://obrien-ben.github.io/transittraj/reference/plot_animated_line.md)
  : Animate vehicle trajectory or AVL data.
- [`plot_trajectory()`](https://obrien-ben.github.io/transittraj/reference/plot_trajectory.md)
  : Plot vehicle trajectories or AVL data.
- [`export_animation()`](https://obrien-ben.github.io/transittraj/reference/export_animation.md)
  : Save your animation at a desired quality.

## Methods for Trajectories

Functions for using trajectories.

- [`predict(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/predict.avltrajectory_group.md)
  [`predict(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/predict.avltrajectory_group.md)
  : Interpolate time or distance points using AVL trajectories.
- [`print(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/print.avltrajectory_group.md)
  [`print(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/print.avltrajectory_group.md)
  : Print function for AVL trajectories
- [`summary(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/summary.avltrajectory_group.md)
  [`summary(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/summary.avltrajectory_group.md)
  : Summary function for AVL trajectories.

## Data Validation

Functions for validating data.

- [`validate_tides()`](https://obrien-ben.github.io/transittraj/reference/validate_tides.md)
  : Check if an AVL dataframe meets TIDES standards.
- [`validate_monotonicity()`](https://obrien-ben.github.io/transittraj/reference/validate_monotonicity.md)
  : Check if an AVL dataframe satisfies assumptions of monotonicity.

## Supporting Datasets

Datasets to test with.

- [`wmata_avl`](https://obrien-ben.github.io/transittraj/reference/wmata_avl.md)
  : WMATA Bus Automatic Vehicle Location Data
- [`wmata_gtfs`](https://obrien-ben.github.io/transittraj/reference/wmata_gtfs.md)
  : WMATA Bus GTFS

# Articles

### All vignettes

- [about](https://obrien-ben.github.io/transittraj/articles/about.md):
- [The AVL Cleaning
  Workflow](https://obrien-ben.github.io/transittraj/articles/data-workflow.md):
- [Understanding Data
  Inputs](https://obrien-ben.github.io/transittraj/articles/input-data.md):
- [Introduction to
  Trajectories](https://obrien-ben.github.io/transittraj/articles/intro-trajectories.md):
- [Plotting and Visualization Trajectory
  Data](https://obrien-ben.github.io/transittraj/articles/plotting-trajectories.md):
- [Understanding Trajectory
  Objects](https://obrien-ben.github.io/transittraj/articles/trajectory-objects.md):
